
<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	 <meta content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width" name="viewport">
	<title>蜡笔小新修眉毛</title>
	<link rel="stylesheet" href="../css/base/base.css">
	<link rel="stylesheet" href="../css/base/jquery.mobile.custom.theme.min.css">
	<link rel="stylesheet" href="../css/base/jquery.mobile.custom.structure.min.css">
	<link rel="stylesheet" href="../css/default/labixiaoxin.css">
	<script src="../js/lib/jquery.js"></script>
	<script src="../js/lib/jquery.mobile.min.js"></script>
</head>

<body>

<!-- page1 -->
<div data-role="page" id="one" class="role">
	
	<div class="role-bg">
		<img src="../image/labixiaoxin/page1Bg.jpg" />
		<div class="slide-title"></div>
		<div class="play"></div>
		<div class="pencle"></div>
	</div>	
</div>
<!-- /page1 -->

<!-- page2 -->
<div data-role="page" id="two">
	<div class="role-bg">
		<img src="../image/labixiaoxin/page2Bg.jpg" />
    <div class="game-tv"></div>
		<div class="game-des"><div class="game-des-line"></div></div>		
		<a href="#three"><div class="know"></div></a>
	</div>
</div>
<!-- /page2 -->

<!-- page3 -->
<div data-role="page" id="three"  class="addw">
	<div class="role-bg">
		<img id="page3Bg" class="" style="width:200%;" src="../image/labixiaoxin/page3Bg.jpg" />
		<img id="xiaoxin" class="" src="../image/labixiaoxin/xiaoxinclose.png" />
		<img id="gameBg" src="../image/labixiaoxin/gameBg.jpg" />
		<div class="ready"></div>
		<div class="go"></div>
		<div class="clickBar">
			<img id="clickBtn" src="../image/labixiaoxin/clickBtn.png" />
		</div>
    <div id="eyebrow">
      <img src="../image/labixiaoxin/eyebrow1.png" />
    </div>
    <div id="eyebrowj">
      <img src="../image/labixiaoxin/eyebrowj1.png" />
    </div>
	</div>
</div>
<!-- /page3 -->

<!-- page4 -->
<div data-role="page" id="success">
	<div class="role-bg">		
		<img src="../image/labixiaoxin/success.jpg" />
		<div id="successnext" class="successnext"></div>
	</div>
</div>
<!-- /page4 -->

<!-- page5 -->
<div data-role="page" id="error">
	<div class="role-bg">		
		<img src="../image/labixiaoxin/error.jpg" />
		<div id="retry" class="retry"></div>
	</div>
</div>
<!-- /page5 -->

<script type="text/javascript">
$(function() {
  var _w = $("html").width();

  function state1() {
    $(".slide-title").removeClass("rotate2");
    $(".slide-title").addClass("rotate1");
    setTimeout(state2, 90);
  }

  function state2() {
    $(".slide-title").removeClass("rotate1");
    $(".slide-title").addClass("rotate2");
    setTimeout(state1, 90);
  }

  function state3() {
    $(".pencle").removeClass("rotate2");
    $(".pencle").addClass("rotate1");
    setTimeout(state4, 90);
  }

  function state4() {
    $(".pencle").removeClass("rotate1");
    $(".pencle").addClass("rotate2");
    setTimeout(state3, 90);
  }
  //标题移动并抖动
  if (_w >= 320 && _w < 480) {
    $(".slide-title").animate({
        left: 30,
        top: 140
      },
      1000, function() {
        state1();
      });
  } else if (_w >= 480 && _w < 640) {
    $(".slide-title").animate({
        left: 40,
        top: 220
      },
      1000, function() {
        state1();
      });
  } else if (_w >= 640) {
    $(".slide-title").animate({
        left: 60,
        top: 270
      },
      1000, function() {
        state1();
      });
  }
  //点击触发铅笔时间
  $(".play").click(function() {
    $(".pencle").fadeIn('fast', function() {
      state3();
      setTimeout(function() {
        window.location.href = "#two";
      }, 1000);
    });
  });

  //画面二加载完成之后
  $(document).on("pageshow", "#two", function() {
  	//出现线条
    if (_w >= 320 && _w < 480) {
      $(".game-des-line").animate({
           width: 120
        },
        1000, function() {

        });
    } else if (_w >= 480 && _w < 640) {
      $(".game-des-line").animate({
           width: 180
        },
        1000, function() {
        });
    } else if (_w >= 640) {
      $(".game-des-line").animate({
          width: 240
        },
        1000, function() {});
    }

    $(".game-tv").fadeIn(1000, function() {
      
    });
  });

  //画面三加载完成之后
  $(document).on("pageshow", "#three", function() {
    var isPlay = true;//能否玩游戏
  	$("#clickBtn").unbind("touchstart");
  	$("#clickBtn").unbind("touchend");

    //图片渐渐缩放
    $("#page3Bg").animate({
      "width": "130%"},
      1000, function() {
        $(this).addClass('page3Animate');
    });

    //小新移动
    if (_w >= 320 && _w < 480) {
      $("#xiaoxin").animate({
        "marginTop": -100},
        1000, function() {
          $(this).addClass('page3Animate');
      });
    } else if (_w >= 480 && _w < 640) {
      $("#xiaoxin").animate({
        "marginTop": -150},
        1000, function() {
          $(this).addClass('page3Animate');
      });
    } else if (_w >= 640) {
      $("#xiaoxin").animate({
        "marginTop": -200},
        1000, function() {
          $(this).addClass('page3Animate');          
      });
    }
    
    //先进行眨眼的效果
    var zyInteval = setInterval(function(argument) {
      if ($("#xiaoxin").attr("src").indexOf("xiaoxinclose") != -1) {
        $("#xiaoxin").attr("src", "../image/labixiaoxin/xiaoxin.png");
      } else {
        $("#xiaoxin").attr("src", "../image/labixiaoxin/xiaoxinclose.png");
      }
    }, 100);

    function scrollClickBtn() {
    	//按钮左右不停滚动
    	var _c_btn_w = $("#clickBtn").width();
    	var _c_bar_w = $(".clickBar").width();
    	var _c_btn_l = $("#clickBtn").offset().left;//获取左边的定位
    	var _c_scroll_w = _c_bar_w - _c_btn_w;//可以滚动的位置
    	var _speed = 1000;
    	if(_c_btn_l==0){
    		$("#clickBtn").animate({
    			"marginLeft": _c_scroll_w},
    			_speed, function() {
    			scrollClickBtn();
    		});
    	}else if(_c_btn_l==_c_scroll_w){
    		$("#clickBtn").animate({
    			"marginLeft": 0},
    			_speed, function() {
    			scrollClickBtn();
    		});
    	}
    }


    //眨眼后触发事件
    setTimeout(function() {
      //清除眨眼效果
      clearInterval(zyInteval);
      //开始动画,ready和go的切换
      $(".ready").animate({
        "opacity": 1
      },1000,function(){
        $(".ready").animate({
          "opacity": 0
        },
        1000, function() {
          $(".go").animate({
              "opacity": 1
            },
            1000, function() {
              //小新和背景模糊放大
              $("#page3Bg").addClass('page3StartAnimate');
              $("#xiaoxin").addClass('page3StartAnimate');
              $(".go").animate({
                  "opacity": 0
                },
                300, function() {
                  $("#page3Bg").animate({
                      "opacity": 0
                    },
                    300, function() {
                      /* stuff to do after animation is complete */
                    });
                  $("#xiaoxin").animate({
                      "opacity": 0
                    },
                    300, function() {
                      /* stuff to do after animation is complete */
                    });
                  $("#gameBg").animate({
                      "opacity": 1
                    },
                    300, function() {
                      //出现眉毛，下方开始移动
                      $("#eyebrow").css("display","block");
                      $("#eyebrowj").css("display","block");
                      //移动事件
                      scrollClickBtn();

                      setTimeout(function(){
                        isPlay = false;
                        window.location.href="#error";
                      },10000);

                      //定义点击次数
                      var click_count = 0;

                      //绑定点击事件
                      $("#clickBtn").bind("touchstart",function(e) {
                        if(isPlay){
                          click_count++;
                          //点击次数30次满了，跳到成功页面
                          if(click_count==30){
                            window.location.href="#success";
                          }
                          //判断如果计数器到10了，或者20，切换眉毛
                          if(click_count==10){
                            $("#eyebrow img").attr("src","../image/labixiaoxin/eyebrow2.png");
                          }else if(click_count==20){
                            $("#eyebrow img").attr("src","../image/labixiaoxin/eyebrow3.png");
                          }
                          //眉毛随机飘出
                          flyeyebrow(click_count);
                        }else{
                          return false;
                        }
                      });

                      $("#clickBtn").bind("touchend",function(e) {
                        if(isPlay){
                          $("#eyebrowj img").attr("src","../image/labixiaoxin/eyebrowj1.png");
                        }else{
                          return false;
                        }
                      });

                      //随机飞眉毛
                      function flyeyebrow(click_count) {
                        //夹子动一下
                        eyebrowj1();
                        //产生随机数1,2,3
                        var _eye_random = Math.floor(Math.random()*3+1);
                        //产生飞的随机数1,2,3,4
                        var _eye_fly = Math.floor(Math.random()*4+1);
                        //随机定位
                        var _l = Math.floor(Math.random()*50+1);
                        $("#eyebrow").append("<div class='flybrow' id='flybrow"+click_count+"' style='left:"+(_l+40)+"%;'><img src='../image/labixiaoxin/flybrow"+_eye_random+".png' /></div>");
                        if(_eye_fly==1){
                          //右上飞
                          $("#flybrow"+click_count+"").animate({
                            "right": -1000,
                            "top": -500},
                            1000, function() {
                              $(this).remove();
                          });
                        }else if(_eye_fly==2){
                          //左上飞
                          $("#flybrow"+click_count+"").animate({
                            "left": -1000,
                            "top": -500},
                            1000, function() {
                              $(this).remove();
                          });
                        }else if(_eye_fly==3){
                          //左下飞
                          $("#flybrow"+click_count+"").animate({
                            "left": -1000,
                            "bottom": 0},
                            1000, function() {
                              $(this).remove();
                          });                          
                        }else if(_eye_fly==4){
                          //右下飞
                          $("#flybrow"+click_count+"").animate({
                            "right": -600,
                            "bottom":-200},
                            1000, function() {
                              $(this).remove();
                          });
                        }

                      }

                      function eyebrowj1(click_count) {
                        $("#eyebrowj img").attr("src","../image/labixiaoxin/eyebrowj2.png");
                      }
                    });
                });
            });
        });
      });
      
    }, 600);
  });

  //retry按钮
  $("#retry").click(function(event) {
    window.location.href="#three";
  });

  //成功后next按钮
  $("#successnext").click(function(event) {
    window.location.reload(true);
  });

});
</script>

</body>
</html>
